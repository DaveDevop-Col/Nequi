let s=[{id:1,nombre:"Ahorro Viaje ‚úàÔ∏è",saldo:5e4,meta_ahorro:2e5},{id:2,nombre:"Regalo Mam√° üéÅ",saldo:15e3,meta_ahorro:8e4}],f=3,m=1e5;console.log("[ControladorBolsillos] SIMULADO: Inicializado con datos.");async function v(a,l=null){if(console.log(`[CB SIM] Crear: ${a}, Meta: ${l}`),!a||a.trim()===""){const o="Nombre de bolsillo vac√≠o.";return console.warn(`[CB SIM] ${o}`),{exito:!1,mensaje:o}}const e={id:f++,nombre:a.trim(),saldo:0,meta_ahorro:l?parseFloat(l):null};s.push(e);const t=`¬°Bolsillo "${e.nombre}" creado (sim)!`;return console.log(`[CB SIM] ${t}`,e),{exito:!0,bolsillo:e,mensaje:t}}async function B(){return console.log("[CB SIM] Obteniendo bolsillos...",s),[...s]}async function S(a,l){console.log(`[CB SIM] Abonar $${l} a bolsillo ID: ${a}`),l=parseFloat(l);const e=s.findIndex(o=>o.id===parseInt(a));if(e===-1){const o="Bolsillo no encontrado.";return console.warn(`[CB SIM] ${o}`),{exito:!1,mensaje:o}}if(isNaN(l)||l<=0){const o="Monto a abonar inv√°lido.";return console.warn(`[CB SIM] ${o}`),{exito:!1,mensaje:o}}if(m<l){const o="Saldo principal simulado insuficiente.";return console.warn(`[CB SIM] ${o}`),{exito:!1,mensaje:o}}m-=l,s[e].saldo+=l;const t=`¬°$${l.toLocaleString("es-CO")} abonados a "${s[e].nombre}" (sim)! Saldo principal: $${m.toLocaleString("es-CO")}`;return console.log(`[CB SIM] ${t}`,s[e]),{exito:!0,mensaje:t}}async function $(a,l){console.log(`[CB SIM] Retirar $${l} de bolsillo ID: ${a}`),l=parseFloat(l);const e=s.findIndex(o=>o.id===parseInt(a));if(e===-1){const o="Bolsillo no encontrado.";return console.warn(`[CB SIM] ${o}`),{exito:!1,mensaje:o}}if(isNaN(l)||l<=0){const o="Monto a retirar inv√°lido.";return console.warn(`[CB SIM] ${o}`),{exito:!1,mensaje:o}}if(s[e].saldo<l){const o="Saldo insuficiente en bolsillo (sim).";return console.warn(`[CB SIM] ${o}`),{exito:!1,mensaje:o}}s[e].saldo-=l,m+=l;const t=`¬°$${l.toLocaleString("es-CO")} retirados de "${s[e].nombre}" (sim)! Saldo principal: $${m.toLocaleString("es-CO")}`;return console.log(`[CB SIM] ${t}`,s[e]),{exito:!0,mensaje:t}}const p=document.getElementById("cabecera-app");function g(a,l){const e="modal-crear-bolsillo-nequi";if(document.getElementById(e)){document.getElementById(e).classList.add("visible");return}const t=`
        <div class="modal-nequi-superposicion visible" id="${e}">
            <div class="modal-nequi-contenido">
                <h3>Crear Bolsillo</h3>
                <input type="text" id="nombre-nuevo-bolsillo-modal" placeholder="Dale un nombre (Ej: Viaje)" required>
                <input type="number" id="meta-nuevo-bolsillo-modal" placeholder="Meta de ahorro (opcional)" inputmode="numeric" step="1000">
                <div class="modal-acciones">
                    <button id="btn-guardar-bolsillo-modal" class="btn-primario">Guardar</button>
                    <button id="btn-cancelar-bolsillo-modal" class="btn-secundario">Cancelar</button>
                </div>
            </div>
        </div>
    `;document.body.insertAdjacentHTML("beforeend",t);const o=document.getElementById(e),n=o.querySelector("#btn-guardar-bolsillo-modal"),u=o.querySelector("#btn-cancelar-bolsillo-modal"),c=()=>o.remove();n.addEventListener("click",async()=>{const i=o.querySelector("#nombre-nuevo-bolsillo-modal").value.trim(),r=o.querySelector("#meta-nuevo-bolsillo-modal").value,d=r?parseFloat(r):null;if(!i){alert("El nombre es obligatorio para tu bolsillo.");return}n.disabled=!0,n.textContent="Guardando...";const b=await v(i,d);alert(b.mensaje),n.disabled=!1,n.textContent="Guardar",b.exito&&(c(),l("/bolsillos"))}),u.addEventListener("click",c),o.addEventListener("click",i=>{i.target.id===e&&c()})}async function C(a,l){console.log("Renderizando vistaBolsillos..."),p.innerHTML='<button class="btn-atras" title="Volver">‚Üê</button><h2>Mis Bolsillos</h2><button id="btn-abrir-modal-crear-bolsillo" class="btn-accion-cabecera" title="Crear nuevo bolsillo">+</button>',p.classList.remove("oculto"),document.querySelector("#cabecera-app .btn-atras").onclick=()=>l("/principal"),document.getElementById("btn-abrir-modal-crear-bolsillo").onclick=()=>g(a,l),a.innerHTML='<div id="lista-bolsillos-render" class="lista-items-nequi"><p class="mensaje-carga">Cargando tus bolsillos...</p></div>';const e=document.getElementById("lista-bolsillos-render");try{const t=await B();t.length===0?e.innerHTML='<p class="mensaje-vacio">¬°A√∫n no tienes bolsillos! Crea uno para empezar a ahorrar.</p>':(e.innerHTML=t.map(o=>`
                <div class="tarjeta-bolsillo" data-id-bolsillo="${o.id}">
                    <div class="tarjeta-bolsillo-icono">üêñ</div>
                    <div class="tarjeta-bolsillo-info">
                        <h3>${o.nombre}</h3>
                        <p class="saldo">Disponible: <strong>$${parseFloat(o.saldo||0).toLocaleString("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0})}</strong></p>
                        ${o.meta_ahorro?`<p class="meta">Meta: $${parseFloat(o.meta_ahorro).toLocaleString("es-CO",{minimumFractionDigits:0,maximumFractionDigits:0})}</p>`:""}
                    </div>
                    <div class="tarjeta-bolsillo-acciones">
                        <button class="btn-accion-bolsillo btn-abonar" title="Abonar a ${o.nombre}">Meter Plata</button>
                        <button class="btn-accion-bolsillo btn-retirar" title="Sacar plata de ${o.nombre}">Sacar Plata</button>
                    </div>
                </div>
            `).join(""),e.querySelectorAll(".tarjeta-bolsillo .btn-abonar").forEach(o=>{o.addEventListener("click",async n=>{const u=n.target.closest(".tarjeta-bolsillo").dataset.idBolsillo,c=n.target.closest(".tarjeta-bolsillo").querySelector("h3").textContent,i=prompt(`¬øCu√°nta plata quieres meterle a "${c}"?`);if(i){const r=parseFloat(i);if(!isNaN(r)&&r>0){const d=await S(u,r);alert(d.mensaje),d.exito&&l("/bolsillos")}else alert("Escribe un monto v√°lido, porfa.")}})}),e.querySelectorAll(".tarjeta-bolsillo .btn-retirar").forEach(o=>{o.addEventListener("click",async n=>{const u=n.target.closest(".tarjeta-bolsillo").dataset.idBolsillo,c=n.target.closest(".tarjeta-bolsillo").querySelector("h3").textContent,i=prompt(`¬øCu√°nta plata quieres sacar de "${c}" pa' tu disponible?`);if(i){const r=parseFloat(i);if(!isNaN(r)&&r>0){const d=await $(u,r);alert(d.mensaje),d.exito&&l("/bolsillos")}else alert("Escribe un monto v√°lido, porfa.")}})}))}catch(t){console.error("Error renderizando bolsillos:",t),e.innerHTML='<p class="mensaje-error">¬°Ups! No pudimos cargar tus bolsillos. Intenta de nuevo.</p>'}}export{C as renderizarBolsillos};
