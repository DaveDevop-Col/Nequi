const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/vistaPedirDinero-DamL8g98.js","assets/controladorSolicitudes-C0hB-ihv.js","assets/vistaGestionSolicitudes-CVVwQYLZ.js"])))=>i.map(i=>d[i]);
(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}})();const I="modulepreload",y=function(e){return"/"+e},S={},p=function(r,n,i){let t=Promise.resolve();if(n&&n.length>0){let s=function(d){return Promise.all(d.map(m=>Promise.resolve(m).then(_=>({status:"fulfilled",value:_}),_=>({status:"rejected",reason:_}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),h=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));t=s(n.map(d=>{if(d=y(d),d in S)return;S[d]=!0;const m=d.endsWith(".css"),_=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${_}`))return;const f=document.createElement("link");if(f.rel=m?"stylesheet":I,m||(f.as="script"),f.crossOrigin="",f.href=d,h&&f.setAttribute("nonce",h),document.head.appendChild(f),m)return new Promise((P,b)=>{f.addEventListener("load",P),f.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return t.then(s=>{for(const o of s||[])o.status==="rejected"&&a(o.reason);return r().catch(a)})},v={auth:{getSession:async()=>{console.warn("Supabase simulado: getSession llamado");const e=localStorage.getItem("simulated_nequi_session");if(e)try{const r=JSON.parse(e);if(r.user&&r.expires_at>Date.now())return{data:{session:r},error:null}}catch{localStorage.removeItem("simulated_nequi_session")}return{data:{session:null},error:null}},signInWithPassword:async({email:e,password:r})=>{if(console.warn("Supabase simulado: signInWithPassword llamado para",e),e==="test@nequi.com"&&r==="123"){const n={id:"user-test-123",email:"test@nequi.com",app_metadata:{},user_metadata:{nombre_completo:"Usuario Test"}},i={access_token:"simulated-token",token_type:"bearer",user:n,expires_at:Date.now()+36e5};return localStorage.setItem("simulated_nequi_session",JSON.stringify(i)),{data:{user:n,session:i},error:null}}return{data:{user:null,session:null},error:{message:"Credenciales inválidas (simulación)"}}},signUp:async({email:e,password:r,options:n})=>{console.warn("Supabase simulado: signUp llamado para",e,n);const i={id:`user-sim-${Date.now()}`,email:e,app_metadata:{},user_metadata:(n==null?void 0:n.data)||{}};return console.log("Usuario simulado creado (no guardado en localStorage por defecto tras signUp):",i),{data:{user:i,session:null},error:null}},signOut:async()=>(console.warn("Supabase simulado: signOut llamado"),localStorage.removeItem("simulated_nequi_session"),{error:null}),onAuthStateChange:e=>(console.warn("Supabase simulado: onAuthStateChange suscrito"),setTimeout(async()=>{const{data:{session:r}}=await v.auth.getSession();r?e("SIGNED_IN",r):e("SIGNED_OUT",null)},100),window.addEventListener("simulated_auth_change",r=>{e(r.detail.evento,r.detail.sesion)}),{data:{subscription:{unsubscribe:()=>console.log("Suscripción simulada de auth cancelada")}}})}},c=document.getElementById("app"),u=document.getElementById("navegacion-principal"),E=document.getElementById("cabecera-app");let g=null;p(()=>import("./controladorAuth-DpLKHvu7.js"),[]).then(e=>{console.log("PRUEBA INICIAL IMPORTACIÓN AuthModule:",e),e&&typeof e.obtenerMiPerfil=="function"?console.log("PRUEBA INICIAL: obtenerMiPerfil SÍ es una función."):console.error("PRUEBA INICIAL: obtenerMiPerfil NO es una función o AuthModule es undefined.")}).catch(e=>console.error("PRUEBA INICIAL: Error importando controladorAuth.js:",e));async function l(e){if(console.log(`[Principal.js] Navegando a: ${e}`),!c){console.error("Elemento #app no encontrado. Verifica index.html.");return}c.innerHTML='<div class="mensaje-carga"><p>Cargando...</p></div>',E&&E.classList.add("oculto"),u&&u.classList.add("oculto");const r=await p(()=>import("./controladorAuth-DpLKHvu7.js"),[]),n=await r.verificarSesionActual();if(e==="/login"&&!n){const{renderizarLogin:i}=await p(async()=>{const{renderizarLogin:t}=await Promise.resolve().then(()=>A);return{renderizarLogin:t}},void 0);i(c,r,l);return}if(e==="/registro"&&!n){const{renderizarRegistro:i}=await p(async()=>{const{renderizarRegistro:t}=await Promise.resolve().then(()=>L);return{renderizarRegistro:t}},void 0);i(c,r,l);return}if(!n){console.log("[Principal.js] No hay sesión, redirigiendo a /login"),l("/login");return}if(g||(g=await r.obtenerMiPerfil()),!g&&e!=="/login"&&e!=="/registro"){console.error("[Principal.js] Sesión activa pero no se pudo cargar el perfil. Cerrando sesión simulada."),await r.cerrarSesion();return}switch(u&&u.classList.remove("oculto"),e){case"/":case"/principal":const{renderizarPrincipalNequi:i}=await p(async()=>{const{renderizarPrincipalNequi:o}=await Promise.resolve().then(()=>O);return{renderizarPrincipalNequi:o}},void 0);g?i(c,g,l):(console.error("[Principal.js] Intentando renderizar vista principal sin perfil."),l("/login"));break;case"/bolsillos":const{renderizarBolsillos:t}=await p(async()=>{const{renderizarBolsillos:o}=await import("./vistaBolsillos-CVR9nXLY.js");return{renderizarBolsillos:o}},[]);await t(c,l);break;case"/pedir-dinero":const{renderizarPedirDinero:a}=await p(async()=>{const{renderizarPedirDinero:o}=await import("./vistaPedirDinero-DamL8g98.js");return{renderizarPedirDinero:o}},__vite__mapDeps([0,1]));a(c,l);break;case"/solicitudes":const{renderizarGestionSolicitudes:s}=await p(async()=>{const{renderizarGestionSolicitudes:o}=await import("./vistaGestionSolicitudes-CVVwQYLZ.js");return{renderizarGestionSolicitudes:o}},__vite__mapDeps([2,1]));await s(c,l);break;case"/enviar-dinero":try{const{renderizarEnviarDinero:o}=await p(async()=>{const{renderizarEnviarDinero:h}=await Promise.resolve().then(()=>D);return{renderizarEnviarDinero:h}},void 0);o(c,l)}catch(o){console.error("Error cargando vistaEnviarDinero.js:",o),c.innerHTML="<p class='mensaje-error'>Módulo de Enviar Dinero no disponible aún.</p>"}break;default:console.warn(`[Principal.js] Ruta desconocida: ${e}.`),l(n?"/principal":"/login")}}window.navegarHacia=l;function w(){u&&(u.innerHTML=`
        <button data-ruta="/principal" title="Inicio"><img src="/iconos/casa.svg" alt="Inicio"> Inicio</button>
        <button data-ruta="/bolsillos" title="Bolsillos"><img src="/iconos/bolsillos.svg" alt="Bolsillos"> Bolsillos</button>
        <button data-ruta="/pedir-dinero" title="Pedir Dinero"><img src="/iconos/pedir.svg" alt="Pedir"> Pedir</button>
        <button data-ruta="/enviar-dinero" title="Enviar Dinero"><img src="/iconos/enviar.svg" alt="Enviar"> Enviar</button>
        <button data-ruta="/solicitudes" title="Notificaciones"><img src="/iconos/notificaciones.svg" alt="Campana"> Campana</button>
    `,u.querySelectorAll("button[data-ruta]").forEach(e=>{e.addEventListener("click",()=>{u.querySelectorAll("button[data-ruta]").forEach(r=>r.classList.remove("activo")),e.classList.add("activo"),l(e.dataset.ruta)})}))}v&&v.auth&&typeof v.auth.onAuthStateChange=="function"?v.auth.onAuthStateChange(async(e,r)=>{console.log("[Principal.js] Evento Auth Supabase:",e,r);const n=await p(()=>import("./controladorAuth-DpLKHvu7.js"),[]);if(e==="SIGNED_IN"||e==="INITIAL_SESSION"&&r)if(g=await n.obtenerMiPerfil(),g){console.log("[Principal.js] Perfil cargado:",g),w();const i=window.location.hash.substring(1)||"/",a=i==="/login"||i==="/registro"?"/":i;l(a);const s=u.querySelector(`button[data-ruta="${a}"]`);s&&s.classList.add("activo")}else console.error("[Principal.js] SIGNED_IN pero no se pudo cargar perfil. Cerrando sesión."),await n.cerrarSesion();else(e==="SIGNED_OUT"||e==="INITIAL_SESSION"&&!r)&&(console.log("[Principal.js] SIGNED_OUT o no hay sesión inicial."),g=null,u&&(u.classList.add("oculto"),u.innerHTML=""),l("/login"))}):(console.error("CRÍTICO: supabase.auth.onAuthStateChange no está disponible. Verifica clienteSupabase.js."),c&&(c.innerHTML="<p class='mensaje-error'>Error crítico de inicialización.</p>"));document.addEventListener("DOMContentLoaded",()=>{console.log("[Principal.js] DOM completamente cargado y parseado."),"serviceWorker"in navigator&&navigator.serviceWorker.register("/serviceWorker.js").then(e=>console.log("[SW Registrado]",e.scope)).catch(e=>console.log("[SW Error Registro]",e))});console.log("[Principal.js] Archivo cargado.");const A=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),L=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),O=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),D=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{v as s};
